<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<!-- 네임스페이스(사용영역) 설정 -->
<mapper namespace="com.euishoe.carts">
	<resultMap type="com.euishoe.carts.dto.Cart" id="Cart">
		<result property="cartNum" column="cart_num"/>
    	<result property="productCode" column="product_code"/>
    	<result property="customerId" column="customer_id"/>
	</resultMap>
	
	<select id="listCart" resultMap="Cart">
        select cart_num, 
               product_code,
               customer_id 
        from carts
	</select>
	
	
	<insert id="createCart" parameterType="map">
		INSERT INTO CARTS(CART_NUM,PRODUCT_CODE,CUSTOMER_ID) VALUES(CARTS_SEQ.nextval,CONCAT(CONCAT(#{productCode},'#'),PRODUCT_SEQ.currval),#{customerId})
	</insert> 
	
	<delete id="deleteCart">
		DELETE FROM CARTS WHERE PRODUCT_CODE LIKE #{productCode}
	</delete>
	
	<!-- 장바구니에 들어있는지 확인하고, 장바구니 수량 수정  -->
	<update id="updateCart">
		UPDATE CARTS SET
	</update>
	<select id="listCartForLogin" resultType="map" parameterType="String">
 SELECT c.*, 
       p.*, 
       pi.*, 
       i.*, 
       substr(i.image_ref, -10, 6) str 
FROM   carts c 
       INNER JOIN products p 
               ON c.product_code = p.product_code 
       INNER JOIN product_infos pi 
               ON p.product_num = pi.product_num 
       INNER JOIN images i 
               ON i.product_num = pi.product_num 
WHERE  customer_id LIKE #{customerId}
       AND substr(i.image_ref, -10, 6) LIKE 'main$1' 
   </select>
</mapper>
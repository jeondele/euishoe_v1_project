<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<!-- 네임스페이스(사용영역) 설정 -->
<mapper namespace="com.euishoe.PointHistory">

	<!-- 회원가입 포인트 지급 -->
	<insert id="joinPointCreate" parameterType="String">
		INSERT INTO point_histories
		VALUES  (point_histories_seq.nextval,
        		     1, 
             		 #{customerId}, 
       			     2000, 
             		 TO_CHAR(sysdate, 'YYYY-MM-DD'))
	</insert>

	<!-- 생일축하 포인트 지급 -->
	<insert id="birthPointCreate" parameterType="com.euishoe.points.dto.PointHistory">
		INSERT INTO point_histories
		VALUES  (point_histories_seq.nextval,
        		     2, 
             		 #{customerId}, 
       			     2000, 
             		 TO_CHAR(sysdate, 'YYYY-MM-DD'))
	</insert>

	<!--구매 포인트 지급 -->
	<insert id="purchasePointCreate" parameterType="com.euishoe.points.dto.PointHistory">
		INSERT INTO point_histories
		VALUES  (point_histories_seq.nextval,
        		     3, 
             		 #{customerId}, 
       			     #{pointHistoryScore}, 
             		 TO_CHAR(sysdate, 'YYYY-MM-DD'))
	</insert>
	
	<!-- 포인트 사용 -->
	<insert id="usingPointCreate" parameterType="com.euishoe.points.dto.PointHistory">
		INSERT INTO point_histories
		VALUES  (point_histories_seq.nextval,
        		     4, 
             		 #{customerId}, 
       			     #{pointHistoryScore}, 
             		 TO_CHAR(sysdate, 'YYYY-MM-DD'))
	</insert>
	
	<select id="selectPointHistoryById" parameterType="String" resultType="Map">
		SELECT 	sum(ph.point_history_score) OVER(order by point_history_update_date) as "totalScore",
				ph.*,
   				pp.*
	    FROM    point_histories ph
		  		INNER JOIN point_policies pp
		    	ON ph.point_policy_type = pp.point_policy_type
		 WHERE  ph.customer_id = #{customerId}
	</select>

</mapper>